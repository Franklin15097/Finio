# üîê Finio - –¢–æ–ª—å–∫–æ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

## ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

### –£–¥–∞–ª–µ–Ω–æ:
- ‚ùå Email/–ø–∞—Ä–æ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- ‚ùå Email/–ø–∞—Ä–æ–ª—å –≤—Ö–æ–¥
- ‚ùå –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- ‚ùå –°—Ç–∞—Ä—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã –±–µ–∑ Telegram

### –û—Å—Ç–∞–ª–æ—Å—å:
- ‚úÖ –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ
- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Telegram ID

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### 1. –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ –≤ Telegram
2. –ù–∞–∂–∏–º–∞–µ—Ç Menu Button
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–∫–∫–∞—É–Ω—Ç —Å Telegram ID
4. –°–æ–∑–¥–∞—é—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Å—á–µ—Ç–∞ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
5. –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

### 2. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ –≤ Telegram
2. –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç –∞–∫–∫–∞—É–Ω—Ç –ø–æ Telegram ID
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
4. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–µ—Å—Ç–µ!

### 3. –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π
- –û–±—ä—è—Å–Ω—è–µ—Ç—Å—è, —á—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Telegram
- –î–∞—é—Ç—Å—è —à–∞–≥–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ –±–æ—Ç–∞

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
```sql
users:
  - id (PRIMARY KEY)
  - telegram_id (UNIQUE, NOT NULL –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
  - telegram_username
  - name
  - email (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: tg{telegram_id}@telegram.user)
  - password_hash (NULL)
  - created_at
```

### API Endpoints:

**POST /api/auth/telegram**
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç: `{ initData: string }`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{ token, user }`
- –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –≤—Ö–æ–¥–∏—Ç –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π

**GET /api/auth/me**
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- –¢—Ä–µ–±—É–µ—Ç: Bearer token –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{ user }`

### Frontend:

**Auth —Å—Ç—Ä–∞–Ω–∏—Ü–∞:**
- –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –≤ Telegram ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
- –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Üí –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Telegram

**AuthContext:**
- `loginWithTelegram()` - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –≤—Ö–æ–¥–∞
- `logout()` - –≤—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
- `isTelegram` - —Ñ–ª–∞–≥, –æ—Ç–∫—Ä—ã—Ç–æ –ª–∏ –≤ Telegram

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏:

### –î–æ –æ—á–∏—Å—Ç–∫–∏:
- –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 3
- –° Telegram: 1
- –ë–µ–∑ Telegram: 2

### –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:
- –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 1
- –° Telegram: 1
- –ë–µ–∑ Telegram: 0

## üé® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Telegram-only:

‚ú® **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –û–¥–∏–Ω –∫–ª–∏–∫ –¥–ª—è –≤—Ö–æ–¥–∞  
üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Telegram –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
üì± **–£–¥–æ–±—Å—Ç–≤–æ**: –í—Å–µ–≥–¥–∞ –ø–æ–¥ —Ä—É–∫–æ–π –≤ Telegram  
üöÄ **–°–∫–æ—Ä–æ—Å—Ç—å**: –ù–µ—Ç —Ñ–æ—Ä–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏  
üîÑ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —á–µ—Ä–µ–∑ Telegram ID  
üíæ **–ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö**: –ù–µ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏  

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

### –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram Web App:
```javascript
1. –ü–æ–ª—É—á–∞–µ–º initData –æ—Ç Telegram
2. –ò–∑–≤–ª–µ–∫–∞–µ–º hash –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
3. –°–æ–∑–¥–∞–µ–º data_check_string
4. –í—ã—á–∏—Å–ª—è–µ–º HMAC-SHA256 —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º
5. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å –ø–æ–ª—É—á–µ–Ω–Ω—ã–º hash
6. –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ª–∏–Ω–Ω—ã–π
```

### JWT —Ç–æ–∫–µ–Ω—ã:
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 30 –¥–Ω–µ–π
- –•—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤

## üì± –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
1. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ –≤ Telegram
2. –ù–∞–∂–º–∏—Ç–µ Menu Button
3. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –ù–∞—á–Ω–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å!

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
```bash
# –î–µ–ø–ª–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
./update_telegram.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
ssh root@85.235.205.99 "pm2 logs finio-backend"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
ssh root@85.235.205.99 "mysql -u app_user -papp_password financial_db -e 'SELECT * FROM users;'"
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

### –¢–µ—Å—Ç 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ –Ω–æ–≤–æ–º Telegram –∞–∫–∫–∞—É–Ω—Ç–µ
2. –ù–∞–∂–º–∏—Ç–µ Menu Button
3. –î–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å—Å—è –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –µ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Å—á–µ—Ç–∞

### –¢–µ—Å—Ç 2: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ —Å–Ω–æ–≤–∞
2. –î–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–π—Ç–∏
3. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–µ—Å—Ç–µ

### –¢–µ—Å—Ç 3: –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://studiofinance.ru
2. –î–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
3. –ù–µ—Ç —Ñ–æ—Ä–º –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## üêõ Troubleshooting:

### "Telegram authentication failed"
**–†–µ—à–µ–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Menu Button –≤ @BotFather

### –ù–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–∫–∫–∞—É–Ω—Ç
**–†–µ—à–µ–Ω–∏–µ**: 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TELEGRAM_BOT_TOKEN –≤ .env
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `pm2 logs finio-backend`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î –≤—ã–ø–æ–ª–Ω–µ–Ω–∞

### –°—Ç–∞—Ä—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã –æ—Å—Ç–∞–ª–∏—Å—å
**–†–µ—à–µ–Ω–∏–µ**:
```bash
ssh root@85.235.205.99
mysql -u app_user -papp_password financial_db < /var/www/studiofinance/backend/database/cleanup_old_accounts.sql
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

- `BOTFATHER_STEPS.txt` - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Menu Button
- `TELEGRAM_SETUP.md` - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- `DEPLOYMENT_SUCCESS.md` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–µ–ø–ª–æ–µ
- `cleanup_old_accounts.sql` - –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –ë–î

---

**Finio —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Telegram!** üöÄ

–ü—Ä–æ—Å—Ç–∞—è, –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏ —É–¥–æ–±–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –æ–¥–∏–Ω –∫–ª–∏–∫.
